{% extends 'base_authenticated.html' %}

{% block content %}
<h2 class="text-2xl font-semibold mb-4">ğŸ“Š Momentum Strategy Results</h2>

<!-- âœ… Rebalance Trigger -->
<form method="post" action="{{ url_for('momentum.momentum_rebalance_process') }}" id="rebalanceForm" class="mb-6">
  <input type="hidden" name="csrf_token" value="{{ csrf_token }}">
  <button type="submit" id="runRebalanceButton"
          class="px-4 py-2 bg-green-600 text-white rounded hover:bg-green-700">
    ğŸ”„ Run Rebalance Screener
  </button>
  <span id="rebalanceSpinner" class="ml-3 hidden text-green-600 animate-spin">â³</span>
</form>

<!-- âœ… Summary Toast -->
{% if summary_message %}
  <p data-summary-message class="text-green-700 bg-green-100 border border-green-300 rounded px-4 py-2 mb-4">
    {{ summary_message }}
  </p>
{% endif %}

<!-- âœ… Run Date Info -->
<p class="text-sm text-gray-600 mb-4">
  Run Date: {{ run_date }} | Scheduled Date: {{ next_schedule_date }}
</p>

<!-- ğŸ”´ Removal List -->
<h3 class="text-xl text-red-600 mt-6 mb-2">Underperformers (To Remove)</h3>
{% if removed %}
<ul class="list-disc pl-6">
  {% for stock in removed %}
    <li>{{ stock.symbol }} â€” Bought at â‚¹{{ stock.buy_price }}</li>
  {% endfor %}
</ul>
{% else %}
<p class="text-gray-600">âœ… All current holdings are still in the top 20. No removals this cycle.</p>
{% endif %}

<!-- ğŸŸ¢ Addition List -->
<h3 class="text-xl text-green-600 mt-6 mb-2">New Additions (To Buy)</h3>
{% if added %}
<ul class="list-disc pl-6">
  {% for stock in added %}
    <li>{{ stock.symbol }} â€” Current Price â‚¹{{ stock.current_price }} | Rank {{ stock.rank }}</li>
  {% endfor %}
</ul>
{% else %}
<p class="text-gray-600">âœ… No new additions needed. Portfolio remains unchanged.</p>
{% endif %}

<!-- âœ… Spinner + Toast Script -->
<script>
document.getElementById("rebalanceForm")?.addEventListener("submit", function(e) {
  const btn = document.getElementById("runRebalanceButton");
  const spinner = document.getElementById("rebalanceSpinner");

  btn.disabled = true;
  btn.textContent = "Processing...";
  spinner.classList.remove("hidden");
});

window.addEventListener("load", function() {
  const message = document.querySelector("[data-summary-message]")?.textContent;
  if (message) {
    const toast = document.createElement("div");
    toast.textContent = message;
    toast.className = "fixed bottom-4 right-4 bg-green-600 text-white px-4 py-2 rounded shadow-lg z-50";
    document.body.appendChild(toast);
    setTimeout(() => toast.remove(), 4000);
  }
});
</script>
{% endblock %}
