{% extends 'base.html' %}
{% block content %}
<link rel="stylesheet" href="{{ url_for('static', filename='css/notes.css') }}">
<link href="https://cdn.quilljs.com/1.3.6/quill.snow.css" rel="stylesheet">
<script src="https://cdn.quilljs.com/1.3.6/quill.min.js"></script>



<h2>üìù New Day Notes</h2>

{% with messages = get_flashed_messages(with_categories=true) %}
  {% if messages %}
    {% for category, msg in messages %}
      <div class="flash-{{ category }}">{{ msg }}</div>
    {% endfor %}
  {% endif %}
{% endwith %}

<button onclick="openNoteModal()" class="button primary">‚ûï Add Note</button>

<hr>

<div class="notes-wrapper container-fluid px-4">
  <div class="row justify-content-center">
    <div class="col-lg-10">
      <div class="notes-list">
        {% for note in notes %}
        <div class="note-card mb-4 p-3 border rounded shadow-sm">
          <div class="note-header mb-2">
            <strong>{{ note.date }}</strong> ‚Äî {{ note.summary }}
          </div>
          <div class="note-body mb-2">
            {{ note.content | safe }}
          </div>
          {% if note.images %}
          <div class="note-images d-flex flex-wrap gap-3 mb-2">
            {% for img in note.images %}
            <div class="image-thumb position-relative">
              <img src="{{ url_for('static', filename='uploads/' ~ img.filename) }}" class="img-thumbnail" style="max-width: 150px;">
              <form method="POST" action="{{ url_for('notes.delete_image', id=img.id) }}" onsubmit="return confirm('Delete image?')" class="position-absolute top-0 end-0">
                <button type="submit" class="btn btn-sm btn-danger">‚ùå</button>
              </form>
            </div>
            {% endfor %}
          </div>
          {% endif %}
          <div class="note-actions d-flex gap-2">
            <a href="{{ url_for('notes.edit_note', id=note.id) }}" class="btn btn-sm btn-primary">‚úèÔ∏è Edit</a>
            <form method="POST" action="{{ url_for('notes.delete_note', id=note.id) }}">
              <input type="hidden" name="csrf_token" value="{{ csrf_token() }}">
              <button type="submit" class="btn btn-sm btn-danger" onclick="return confirm('Delete this note?')">üóëÔ∏è Delete</button>
            </form>
          </div>
        </div>
        {% endfor %}
      </div>
    </div>
  </div>
</div>



<!-- Modal -->
<div id="note-modal" class="modal">
  <form method="POST" action="{{ url_for('notes.add_note') }}" enctype="multipart/form-data" onsubmit="syncEditor()">
    <input type="hidden" name="csrf_token" value="{{ csrf_token() }}">
    <label>Date</label>
    <input type="date" name="date" value="{{ today if today else '' }}" required>


    <label>Summary</label>
    <input type="text" name="summary" required>
    <label>Notes</label>
    <div id="editor"></div>
    <input type="hidden" name="content" id="hidden-content">
    <label>Attach Images</label>
    <input type="file" name="images" multiple accept="image/*">
    <div class="modal-actions">
      <button type="submit">üíæ Save</button>
      <button type="button" onclick="closeNoteModal()">‚ùå Cancel</button>
    </div>
  </form>
</div>

<script>
var quill = new Quill('#editor', {
  theme: 'snow',
  placeholder: 'Write your notes here...',
  modules: {
    toolbar: [
    [{ 'header': [1, 2, 3, false] }],
    ['bold', 'italic', 'underline', 'strike'],
    [{ 'color': [] }, { 'background': [] }],
    [{ 'list': 'ordered' }, { 'list': 'bullet' }],
    [{ 'align': [] }],
    ['blockquote', 'code-block'],
    ['link', 'image'],
    ['clean']
    ]

  }
});


function syncEditor() {
  document.getElementById('hidden-content').value = quill.root.innerHTML;
}
function openNoteModal() {
  document.getElementById('note-modal').style.display = 'block';
}
function closeNoteModal() {
  document.getElementById('note-modal').style.display = 'none';
}
</script>
{% endblock %}
