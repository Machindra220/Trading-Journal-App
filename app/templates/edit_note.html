{% extends "base.html" %}
{% block title %}âœï¸ Edit Note{% endblock %}
{% block content %}

<!-- ğŸ§­ Page Heading -->
<h2 class="text-2xl font-semibold mb-4 text-gray-800">
  âœï¸ Edit Note â€“ {{ note.date }}
</h2>

<!-- ğŸ”” Flash Messages -->
{% with messages = get_flashed_messages(with_categories=true) %}
  {% for category, message in messages %}
    <div class="mb-4 px-4 py-2 rounded bg-blue-100 text-blue-800 text-sm">
      {{ message }}
    </div>
  {% endfor %}
{% endwith %}

<!-- ğŸ“ Edit Note Form -->
<form method="POST"
      action="{{ url_for('notes.edit_note', id=note.id) }}"
      class="max-w-2xl bg-white p-6 rounded shadow">

  <!-- ğŸ” CSRF Protection -->
  <input type="hidden" name="csrf_token" value="{{ csrf_token() }}">

  <!-- ğŸ“… Date Input -->
  <div class="mb-4">
    <label for="date" class="block text-sm font-medium text-gray-700 mb-1">Date</label>
    <input type="date"
           name="date"
           id="date"
           value="{{ note.date.isoformat() }}"
           required
           class="w-full px-3 py-2 border border-gray-300 rounded focus:outline-none focus:ring-2 focus:ring-indigo-500" />
  </div>

  <!-- ğŸ“ Summary Input -->
  <div class="mb-4">
    <label for="summary" class="block text-sm font-medium text-gray-700 mb-1">Summary</label>
    <input type="text"
           name="summary"
           id="summary"
           value="{{ note.summary }}"
           required
           class="w-full px-3 py-2 border border-gray-300 rounded focus:outline-none focus:ring-2 focus:ring-indigo-500" />
  </div>

  <!-- ğŸ§¾ Rich Text Editor -->
  <div class="mb-6">
    <label for="content" class="block text-sm font-medium text-gray-700 mb-1">Content</label>
    <div id="editor" class="border border-gray-300 rounded" style="height: 300px;">
      {{ note.content | safe }}
    </div>
    <input type="hidden" name="content" id="content">
  </div>

  <!-- âœ… Action Buttons -->
  <div class="flex gap-4">
    <button type="submit"
            class="px-4 py-2 bg-indigo-600 text-white rounded hover:bg-indigo-700 transition">
      ğŸ’¾ Save Changes
    </button>
    <a href="{{ url_for('notes.notes_page') }}"
       class="px-4 py-2 border border-gray-300 rounded text-gray-700 hover:bg-gray-100 transition">
      Cancel
    </a>
  </div>
</form>

<!-- ğŸ§  Quill Editor Setup -->
<script>
  var quill = new Quill('#editor', {
    theme: 'snow',
    placeholder: 'Write your note...',
    modules: {
      toolbar: [
        [{ 'header': [1, 2, 3, false] }],
        ['bold', 'italic', 'underline', 'strike'],
        [{ 'color': [] }, { 'background': [] }],
        [{ 'list': 'ordered' }, { 'list': 'bullet' }],
        [{ 'align': [] }],
        ['blockquote', 'code-block'],
        ['link', 'image'],
        ['clean']
      ]
    }
  });

  // Sync Quill content to hidden input before form submit
  document.querySelector('form').onsubmit = function () {
    document.querySelector('#content').value = quill.root.innerHTML;
  };
</script>

{% endblock %}
