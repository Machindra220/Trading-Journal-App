<!DOCTYPE html>
<html lang="en"
      x-data="{ darkMode: localStorage.getItem('darkMode') === 'true', sidebarOpen: true, mobileOpen: false }"
      x-init="$watch('darkMode', val => localStorage.setItem('darkMode', val))"
      :class="{ 'dark': darkMode }">


<head>
  <meta charset="UTF-8" />
  <meta name="viewport" content="width=device-width, initial-scale=1.0" />
  <title>Portfolio App</title>
  <link rel="icon" href="{{ url_for('static', filename='favicon.png') }}" type="image/x-icon">
  <link href="https://cdn.jsdelivr.net/npm/tailwindcss@2.2.19/dist/tailwind.min.css" rel="stylesheet">
  <script src="https://cdn.jsdelivr.net/npm/alpinejs@3.x.x/dist/cdn.min.js" defer></script>
  <script src="{{ url_for('static', filename='js/sort_table.js') }}"></script>
  <style>[x-cloak] { display: none !important; }</style>

</head>

<body class="bg-gray-100 dark:bg-gray-900 text-gray-900 dark:text-gray-100 transition-colors duration-300">

{% if current_user.is_authenticated %}
<div class="flex min-h-screen">

  <!-- Sidebar -->
  <aside :class="sidebarOpen ? 'w-64' : 'w-20'" class="bg-blue-900 text-white transition-all duration-300 flex flex-col">
    <!-- Logo + Toggle -->
    <div class="flex items-center justify-between px-4 py-4">
      <a href="{{ url_for('trades.dashboard') }}">
        <img src="{{ url_for('static', filename='logo.png') }}" alt="Logo" class="h-10">
      </a>
      <button @click="sidebarOpen = !sidebarOpen" class="text-white text-xl focus:outline-none">
        <span x-show="sidebarOpen">â´</span>
        <span x-show="!sidebarOpen">âµ</span>
      </button>
    </div>

    <!-- Navigation -->
    <nav class="flex-1 px-2 space-y-2 text-sm font-medium">
      {% set active = 'bg-white text-blue-900 font-semibold dark:bg-gray-100 dark:text-blue-900' %}
      {% set inactive = 'hover:bg-blue-700 text-white' %}
      {% macro navlink(endpoint, label, icon) %}
        <a href="{{ url_for(endpoint) }}"
           class="flex items-center gap-2 px-3 py-2 rounded {{ active if request.endpoint == endpoint else inactive }}">
          <span>{{ icon }}</span>
          <span x-show="sidebarOpen" x-cloak >{{ label }}</span>
        </a>
      {% endmacro %}

      {{ navlink('trades.dashboard', 'Dashboard', 'ğŸ ') }}
      {{ navlink('trades.add_trade', 'Add Trade', 'â•') }}
      {{ navlink('trades.trade_history', 'History', 'ğŸ“œ') }}
      {{ navlink('resources.show_resources', 'Resources', 'ğŸ§°') }}
      {{ navlink('risk.risk_calculator', 'Calculator', 'ğŸ§®') }}
      {{ navlink('notes.notes_page', 'Notes', 'ğŸ“') }}
      {{ navlink('stats.stats_dashboard', 'Stats', 'ğŸ“Š') }}
      {{ navlink('calendar.calendar_view', 'Calendar', 'ğŸ“…') }}

      <!-- Divider: Analysis -->
      <div class="border-t border-blue-700 my-2" x-show="sidebarOpen"></div>
      <div class="px-3 text-xs uppercase tracking-wide text-blue-300" x-show="sidebarOpen">Analysis</div>
      {{ navlink('performers.top_performers', 'Performers', 'ğŸ“ˆ') }}
      {{ navlink('delivery.delivery_surge', 'Delivery', 'ğŸš€') }}
      {{ navlink('screener.stage2_view', 'Stage 2 Screener', 'ğŸ“Š') }}
      {{ navlink('screener.stage2_saved', 'Saved Stage 2', 'ğŸ“¦') }}
      {{ navlink('screener.sector_analysis', 'Sector Analysis', 'ğŸ“Š') }}

      <!-- Divider: Watchlist -->
      <div class="border-t border-blue-700 my-2" x-show="sidebarOpen"></div>
      {{ navlink('watchlist.add', 'Watchlist', 'ğŸ“ˆ') }}

      <!-- Logout -->
      <a href="{{ url_for('auth.logout') }}"
         class="flex items-center gap-2 px-3 py-2 border border-red-300 text-red-300 hover:bg-red-100 rounded">
        ğŸšª <span x-show="sidebarOpen">Logout</span>
      </a>
    </nav>

    <!-- Dark Mode Toggle -->
    <div class="px-4 py-3 border-t border-blue-700 text-sm">
      <label class="flex items-center gap-2 cursor-pointer">
        <input type="checkbox" x-model="darkMode" class="form-checkbox h-4 w-4 text-blue-600">
        <span x-show="sidebarOpen" x-cloak>ğŸŒ™ Dark Mode</span>
      </label>
    </div>

  </aside>

  <!-- Mobile Header -->
  <header class="lg:hidden bg-blue-900 text-white p-4 flex justify-between items-center w-full">
    <div class="flex items-center gap-2">
      <a href="{{ url_for('trades.dashboard') }}">
        <img src="{{ url_for('static', filename='logo.png') }}" alt="Logo" class="h-8">
      </a>
      <span class="text-lg font-semibold">Portfolio</span>
    </div>
    <button @click="mobileOpen = !mobileOpen" class="text-2xl focus:outline-none">â˜°</button>
  </header>

  <!-- Mobile Menu -->
  <div x-show="mobileOpen" x-transition class="lg:hidden bg-blue-900 text-white w-full p-4 space-y-2 text-sm font-medium">
    {{ navlink('trades.dashboard', 'Dashboard', 'ğŸ ') }}
    {{ navlink('trades.add_trade', 'Add Trade', 'â•') }}
    {{ navlink('trades.trade_history', 'History', 'ğŸ“œ') }}
    {{ navlink('resources.show_resources', 'Resources', 'ğŸ§°') }}
    {{ navlink('risk.risk_calculator', 'Calculator', 'ğŸ§®') }}
    {{ navlink('notes.notes_page', 'Notes', 'ğŸ“') }}
    {{ navlink('stats.stats_dashboard', 'Stats', 'ğŸ“Š') }}
    {{ navlink('calendar.calendar_view', 'Calendar', 'ğŸ“…') }}
    {{ navlink('performers.top_performers', 'Performers', 'ğŸ“ˆ') }}
    {{ navlink('delivery.delivery_surge', 'Delivery', 'ğŸš€') }}
    {{ navlink('screener.stage2_view', 'Stage 2 Screener', 'ğŸ“Š') }}
    {{ navlink('screener.stage2_saved', 'Saved Stage 2', 'ğŸ“¦') }}
    {{ navlink('screener.sector_analysis', 'Sector Analysis', 'ğŸ“Š') }}
    {{ navlink('watchlist.add', 'Watchlist', 'ğŸ“ˆ') }}
    <a href="{{ url_for('auth.logout') }}"
       class="block px-3 py-2 border border-red-300 text-red-300 hover:bg-red-100 rounded">ğŸšª Logout</a>
  </div>

  <!-- Main Content -->
  <main class="flex-grow p-4">
    {% if current_user.is_authenticated and pinned_resources %}
    <div class="flex items-center gap-2 mb-4 overflow-x-auto whitespace-nowrap">
      <strong>ğŸ“Œ Pinned:</strong>
      {% for r in pinned_resources %}
      <a href="{{ url_for('resources.access_resource', id=r.id) }}" target="_blank" rel="noopener noreferrer"
         class="px-2 py-1 text-sm border border-blue-500 rounded text-blue-600 hover:bg-blue-100 dark:border-blue-300 dark:text-blue-300 dark:hover:bg-blue-800">
        ğŸ”— {{ r.title }}
      </a>
      {% endfor %}
    </div>
    {% endif %}

    {% block content %}{% endblock %}
  </main>
</div>
{% endif %}

<!-- Footer -->
<footer class="border-t border-gray-300 dark:border-gray-700 bg-white dark:bg-gray-800 text-sm text-gray-600 dark:text-gray-300">
  <div class="max-w-7xl mx-auto px-4 py-6 flex flex-col sm:flex-row justify-between items-center">
    <div class="mb-2 sm:mb-0">
      Â© 2025 Portfolio App â€” Built with â¤ï¸ by Machindra
    </div>
    <div class="flex gap-4">
      <a href="https://github.com/Machindra220" target="_blank" class="hover:text-indigo-600 dark:hover:text-indigo-400">GitHub</a>
      <a href="{{ url_for('resources.show_resources') }}" class="hover:text-indigo-600 dark:hover:text-indigo-400">Resources</a>
      <a href="{{ url_for('auth.logout') }}" class="hover:text-red-600 dark:hover:text-red-400">Logout</a>
    </div>
  </div>
</footer>

</body>
</html>
