{% extends "base.html" %}
{% block content %}
<h2 class="text-xl font-semibold mb-2">ðŸ“¦ Saved Stage 2 Stocks (Last 30 Days)</h2>

{% if error %}
  <p class="text-red-600 bg-red-100 border border-red-300 rounded px-4 py-2 mb-4">
    {{ error }}
  </p>
{% elif stocks %}
  <p class="text-sm text-gray-600 mb-4">Showing stocks screened and saved in the database.</p>

  <table class="min-w-full bg-white rounded shadow">
    <thead class="bg-blue-100 text-left">
      <tr>
        <th class="px-4 py-2">#</th>
        <th class="px-4 py-2">Date</th>
        <th class="px-4 py-2">Symbol</th>
        <th class="px-4 py-2">Price</th>
        <th class="px-4 py-2">30W MA</th>
        <th class="px-4 py-2">Volume</th>
        <th class="px-4 py-2">Avg Volume</th>
        <th class="px-4 py-2">Rel Strength</th>
        <th class="px-4 py-2">Days Present</th>
        <th class="px-4 py-2">Tag</th>
      </tr>
    </thead>
    <tbody>
      {% for stock in stocks %}
      <tr class="border-t">
        <td class="px-4 py-2">{{ loop.index }}</td>
        <td class="px-4 py-2">{{ stock.date.strftime('%d-%b-%Y') }}</td>
        <td class="px-4 py-2 flex items-center gap-2">
          <span>{{ stock.symbol }}</span>
          <button onclick="copyToClipboard('{{ stock.symbol }}')" class="text-blue-600 hover:underline text-sm">ðŸ“‹ Copy</button>
        </td>
        <td class="px-4 py-2">{{ stock.price }}</td>
        <td class="px-4 py-2">{{ stock.ma_30w }}</td>
        <td class="px-4 py-2">{{ stock.volume }}</td>
        <td class="px-4 py-2">{{ stock.vol_avg }}</td>
        <td class="px-4 py-2">{{ stock.rs }}</td>
        <td class="px-4 py-2">{{ stock.days_present }}</td>
        <td class="px-4 py-2">{{ stock.tag }}</td>
      </tr>
      {% endfor %}
    </tbody>
  </table>
{% else %}
  <p class="text-yellow-600 bg-yellow-100 border border-yellow-300 rounded px-4 py-2 mt-4">
    No Stage 2 stocks saved in the last 30 days.
  </p>
{% endif %}

<script>
function copyToClipboard(text) {
  navigator.clipboard.writeText(text).then(() => {
    alert(`Copied: ${text}`);
  });
}
</script>
{% endblock %}
