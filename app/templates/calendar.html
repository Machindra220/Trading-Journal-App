{% extends "base_authenticated.html" %}
{% block content %}
<div class="max-w-4xl mx-auto px-4 py-6">
  {% set month_name = datetime(year, month, 1).strftime('%B') %}
  <div class="flex justify-between items-center mb-4">
    <a href="{{ url_for('calendar.calendar_view', month=(month-1 if month > 1 else 12), year=(year if month > 1 else year-1)) }}"
       class="text-sm px-3 py-1 bg-gray-200 rounded hover:bg-gray-300">← Prev</a>
    <h2 class="text-xl font-semibold text-gray-800">{{ month_name }} {{ year }}</h2>
    <a href="{{ url_for('calendar.calendar_view', month=(month+1 if month < 12 else 1), year=(year if month < 12 else year+1)) }}"
       class="text-sm px-3 py-1 bg-gray-200 rounded hover:bg-gray-300">Next →</a>
  </div>

  <div class="grid grid-cols-7 gap-px bg-gray-300 text-center text-sm font-medium text-gray-700">
    {% for day in ['Sun','Mon','Tue','Wed','Thu','Fri','Sat'] %}
      <div class="bg-white py-2">{{ day }}</div>
    {% endfor %}
  </div>

  <div class="grid grid-cols-7 gap-px bg-gray-300 mt-px">
    {% set start = datetime(year, month, 1) %}
    {% set weekday = (start.weekday() + 1) % 7 %}
    {% for _ in range(weekday) %}
      <div class="bg-white h-24"></div>
    {% endfor %}

    {% set days_in_month = (datetime(year + (month // 12), (month % 12) + 1, 1) - timedelta(days=1)).day %}
    {% for day in range(1, days_in_month + 1) %}
      {% set date_str = '{}-{:02d}-{:02d}'.format(year, month, day) %}
      {% set info = daily_pnl.get(date_str) %}
      {% set pnl = info.pnl if info else 0 %}
      {% set stocks = info.stocks if info else [] %}
      {% set bg = 'bg-white' %}
      {% set text = 'text-gray-800' %}
      {% if pnl > 0 %}
        {% set bg = 'bg-green-100' %}
        {% set text = 'text-green-800' %}
      {% elif pnl < 0 %}
        {% set bg = 'bg-red-100' %}
        {% set text = 'text-red-800' %}
      {% endif %}
      {% set is_today = date_str == today.strftime('%Y-%m-%d') %}
      {% if is_today %}
        {% set bg = 'bg-yellow-100' %}
        {% set text = 'text-yellow-800' %}
      {% endif %}
      <div class="{{ bg }} h-24 p-2 text-left text-xs {{ text }} flex flex-col justify-between"
           title="{{ stocks | join(', ') }}">
        <div class="font-semibold">{{ day }}</div>
        {% if pnl != 0 %}
          <div class="text-sm font-medium">₹{{ "%.2f"|format(pnl) }}</div>
        {% endif %}
      </div>
    {% endfor %}
  </div>
</div>
{% endblock %}
