{% extends "base.html" %}
{% block title %}Edit Buy Entry{% endblock %}
{% block content %}
<h2>Edit Buy Entry – {{ trade.stock_name }}</h2>

{% with messages = get_flashed_messages(with_categories=true) %}
  {% for category, message in messages %}
    <div class="flash-{{ category }}">{{ message }}</div>
  {% endfor %}
{% endwith %}

<form method="POST" action="{{ url_for('trades.edit_entry', entry_id=entry.id) }}">
  <input type="hidden" name="csrf_token" value="{{ csrf_token() }}">

  <label for="quantity">Quantity</label>
  <input type="number" name="quantity" id="quantity" value="{{ entry.quantity }}" required min="1" onwheel="this.blur()" oninput="validateQty(this)" />

  <label for="price">Buy Price</label>
  <input type="number" step="0.01" name="price" id="price" value="{{ entry.price }}" required min="0.01" onwheel="this.blur()" />

  <label for="date">Date</label>
  <input type="date" name="date" id="date" value="{{ entry.date.isoformat() if entry.date else current_date }}" required />

  <label for="note">Note</label>
  <textarea name="note" id="note" rows="3" placeholder="Add buy rationale...">{{ entry.note }}</textarea>

  <button type="submit">✅ Update Buy Entry</button>
  <a href="{{ url_for('trades.view_trade', trade_id=trade.id) }}">Cancel</a>
</form>

<script>
  // Set default date to today if not already set
  document.addEventListener('DOMContentLoaded', function() {
    const dateInput = document.getElementById('date');
    if (!dateInput.value) {
      const today = new Date().toISOString().split('T')[0];
      dateInput.value = today;
    }
  });

  // Prevent negative or zero quantity
  function validateQty(input) {
    if (input.value < 1) {
      input.setCustomValidity("Quantity must be at least 1");
    } else {
      input.setCustomValidity("");
    }
  }
</script>
{% endblock %}
