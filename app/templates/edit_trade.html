{% extends "base.html" %}
{% block title %}Edit Trade{% endblock %}
{% block content %}

<!-- üß≠ Page Heading -->
<h2 class="text-2xl font-semibold mb-4 text-gray-800">
  Edit Trade ‚Äì {{ trade.stock_name }}
</h2>

<!-- üîî Flash Messages -->
{% with messages = get_flashed_messages(with_categories=true) %}
  {% for category, message in messages %}
    <div class="mb-4 px-4 py-2 rounded bg-blue-100 text-blue-800 text-sm">
      {{ message }}
    </div>
  {% endfor %}
{% endwith %}

<!-- üìù Edit Trade Form -->
<form method="POST"
      action="{{ url_for('trades.edit_trade', trade_id=trade.id) }}"
      class="max-w-md bg-white p-6 rounded shadow">

  <!-- üîê CSRF Protection -->
  <input type="hidden" name="csrf_token" value="{{ csrf_token() }}">

  <!-- üè∑Ô∏è Stock Name Input -->
  <div class="mb-4">
    <label for="stock_name" class="block text-sm font-medium text-gray-700 mb-1">Stock Name</label>
    <input type="text"
           name="stock_name"
           id="stock_name"
           value="{{ trade.stock_name }}"
           required
           oninput="this.value = this.value.toUpperCase()"
           class="w-full px-3 py-2 border border-gray-300 rounded focus:outline-none focus:ring-2 focus:ring-indigo-500" />
  </div>

  <!-- üìÖ Entry Date -->
  <div class="mb-4">
    <label for="entry_date" class="block text-sm font-medium text-gray-700 mb-1">Entry Date</label>
    <input type="date"
           name="entry_date"
           id="entry_date"
           value="{{ trade.entry_date.isoformat() if trade.entry_date else '' }}"
           class="w-full px-3 py-2 border border-gray-300 rounded focus:outline-none focus:ring-2 focus:ring-indigo-500" />
  </div>

  <!-- üìÖ Exit Date -->
  <div class="mb-4">
    <label for="exit_date" class="block text-sm font-medium text-gray-700 mb-1">Exit Date</label>
    <input type="date"
           name="exit_date"
           id="exit_date"
           value="{{ trade.exit_date.isoformat() if trade.exit_date else '' }}"
           class="w-full px-3 py-2 border border-gray-300 rounded focus:outline-none focus:ring-2 focus:ring-indigo-500" />
  </div>

  <!-- üìù Journal Note -->
  <div class="mb-6">
    <label for="note" class="block text-sm font-medium text-gray-700 mb-1">Journal Note</label>
    <textarea name="journal"
              id="note"
              rows="3"
              placeholder="Add journal or summary..."
              class="w-full px-3 py-2 border border-gray-300 rounded focus:outline-none focus:ring-2 focus:ring-indigo-500">{{ trade.journal }}</textarea>
  </div>

  <!-- ‚úÖ Action Buttons -->
  <div class="flex flex-wrap gap-4">
    <button type="submit"
            class="px-4 py-2 bg-indigo-600 text-white rounded hover:bg-indigo-700 transition">
      ‚úÖ Update Trade
    </button>
    <button type="button"
            onclick="openDeleteModal()"
            class="px-4 py-2 bg-red-600 text-white rounded hover:bg-red-700 transition">
      üóëÔ∏è Delete Trade
    </button>
    <a href="{{ url_for('trades.dashboard') }}"
       class="px-4 py-2 border border-gray-300 rounded text-gray-700 hover:bg-gray-100 transition">
      Cancel
    </a>
  </div>
</form>

<!-- üßæ Delete Confirmation Modal -->
<div id="delete-modal"
     class="fixed inset-0 bg-black bg-opacity-50 z-50 hidden flex items-center justify-center">
  <div class="bg-white p-6 rounded shadow-md w-80 text-center">
    <p class="mb-4">Are you sure you want to delete this trade?</p>
    <form method="POST" action="{{ url_for('trades.delete_trade', trade_id=trade.id) }}">
      <input type="hidden" name="csrf_token" value="{{ csrf_token() }}">
      <button type="submit"
              class="px-4 py-2 bg-red-600 text-white rounded hover:bg-red-700">
        Yes, Delete
      </button>
      <button type="button"
              onclick="closeDeleteModal()"
              class="ml-2 px-4 py-2 border rounded">
        Cancel
      </button>
    </form>
  </div>
</div>

<!-- üß† Modal Logic -->
<script>
function openDeleteModal() {
  document.getElementById('delete-modal').classList.remove('hidden');
}
function closeDeleteModal() {
  document.getElementById('delete-modal').classList.add('hidden');
}
</script>

{% endblock %}
